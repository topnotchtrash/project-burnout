<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design URL Shortener - System Design</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.8;
            color: #2c2c2c;
            background-color: #f9f7f4;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .back-link {
            display: inline-block;
            color: #2c2c2c;
            text-decoration: none;
            margin-bottom: 30px;
            font-size: 0.9rem;
            border-bottom: 1px solid transparent;
            transition: border-bottom 0.2s;
        }

        .back-link:hover {
            border-bottom: 1px solid #2c2c2c;
        }

        header {
            border-bottom: 3px double #2c2c2c;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        .problem-meta {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: normal;
            margin-bottom: 15px;
        }

        .tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.8rem;
            padding: 3px 10px;
            border: 1px solid #2c2c2c;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: normal;
            text-decoration: underline;
            margin-bottom: 15px;
        }

        .requirements-box {
            border: 1px solid #2c2c2c;
            padding: 20px;
            background: #fff;
            margin-bottom: 20px;
        }

        .req-category {
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .req-category:first-child {
            margin-top: 0;
        }

        ul {
            margin-left: 25px;
        }

        li {
            margin: 8px 0;
        }

        .estimation-box {
            background: #fff;
            border: 2px solid #2c2c2c;
            padding: 20px;
            margin: 20px 0;
        }

        .calc-item {
            margin: 10px 0;
            padding-left: 15px;
            border-left: 2px solid #2c2c2c;
        }

        .diagram-box {
            background: #fff;
            border: 1px solid #2c2c2c;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            min-height: 200px;
        }

        .diagram-placeholder {
            color: #666;
            font-style: italic;
        }

        .component-box {
            border-left: 3px solid #2c2c2c;
            padding-left: 20px;
            margin: 20px 0;
        }

        .component-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .code-snippet {
            background: #2c2c2c;
            color: #f9f7f4;
            padding: 15px;
            border: 2px solid #2c2c2c;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
        }

        th, td {
            border: 1px solid #2c2c2c;
            padding: 10px;
            text-align: left;
        }

        th {
            background: #2c2c2c;
            color: #f9f7f4;
            font-weight: normal;
        }

        .tradeoff-box {
            background: #fff;
            border: 1px solid #2c2c2c;
            padding: 20px;
            margin: 20px 0;
        }

        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .pros, .cons {
            border: 1px solid #2c2c2c;
            padding: 15px;
        }

        .pros strong, .cons strong {
            display: block;
            margin-bottom: 10px;
        }

        footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
            text-align: center;
            font-size: 0.8rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">← Back to Main</a>

        <header>
            <div class="problem-meta">System Design | Distributed Systems</div>
            <h1>Design URL Shortener</h1>
            <div class="tags">
                <span class="tag">Scalability</span>
                <span class="tag">Distributed Systems</span>
                <span class="tag">Database Design</span>
            </div>
        </header>

        <!-- Problem Statement -->
        <section class="section">
            <h2 class="section-title">Problem Statement</h2>
            <div class="requirements-box">
                <p>Design a URL shortening service like bit.ly that converts long URLs into shorter, manageable links.</p>
                
                <div class="req-category">Functional Requirements:</div>
                <ul>
                    <li>Given a long URL, generate a unique short URL</li>
                    <li>When users access short URL, redirect to original long URL</li>
                    <li>Users can optionally customize their short URL</li>
                    <li>Short URLs should expire after a configurable time period</li>
                    <li>Track basic analytics (number of clicks)</li>
                </ul>

                <div class="req-category">Non-Functional Requirements:</div>
                <ul>
                    <li>High availability (99.9% uptime)</li>
                    <li>Low latency for redirects (< 100ms)</li>
                    <li>Scalable to handle millions of URLs</li>
                    <li>Short URLs should be as short as possible</li>
                </ul>
            </div>
        </section>

        <!-- Capacity Estimation -->
        <section class="section">
            <h2 class="section-title">Capacity Estimation</h2>
            <div class="estimation-box">
                <div class="calc-item">
                    <strong>Traffic:</strong>
                    <br>- 100M new URLs per month
                    <br>- Read:Write ratio = 100:1
                    <br>- 10B redirections per month
                </div>

                <div class="calc-item">
                    <strong>Storage:</strong>
                    <br>- Average URL size: 500 bytes
                    <br>- 100M URLs/month × 500 bytes = 50GB/month
                    <br>- For 10 years: 50GB × 12 × 10 = 6TB
                </div>

                <div class="calc-item">
                    <strong>Bandwidth:</strong>
                    <br>- Write: 100M × 500 bytes / (30 days × 86400 sec) ≈ 20 KB/s
                    <br>- Read: 10B × 500 bytes / (30 days × 86400 sec) ≈ 2 MB/s
                </div>

                <div class="calc-item">
                    <strong>Cache Memory (80/20 rule):</strong>
                    <br>- 20% of daily reads = 0.2 × 10B/30 ≈ 67M requests/day
                    <br>- 67M × 500 bytes ≈ 33GB cache needed
                </div>
            </div>
        </section>

        <!-- High-Level Design -->
        <section class="section">
            <h2 class="section-title">High-Level Design</h2>
            <div class="diagram-box">
                <div class="diagram-placeholder">
                    [Add architecture diagram here]
                    <br><br>
                    User → Load Balancer → Web Servers → App Servers → Database/Cache
                </div>
            </div>
        </section>

        <!-- API Design -->
        <section class="section">
            <h2 class="section-title">API Design</h2>
            
            <div class="component-box">
                <div class="component-title">1. Create Short URL</div>
                <div class="code-snippet">
<pre>POST /api/v1/shorten
Request:
{
  "long_url": "https://example.com/very/long/url",
  "custom_alias": "mylink",  // optional
  "expiry_date": "2025-12-31" // optional
}

Response:
{
  "short_url": "https://short.ly/abc123",
  "created_at": "2025-09-26T10:30:00Z"
}</pre>
                </div>
            </div>

            <div class="component-box">
                <div class="component-title">2. Redirect Short URL</div>
                <div class="code-snippet">
<pre>GET /{short_code}
Response: HTTP 302 redirect to long_url</pre>
                </div>
            </div>

            <div class="component-box">
                <div class="component-title">3. Delete Short URL</div>
                <div class="code-snippet">
<pre>DELETE /api/v1/url/{short_code}
Response: HTTP 204 No Content</pre>
                </div>
            </div>
        </section>

        <!-- Database Design -->
        <section class="section">
            <h2 class="section-title">Database Schema</h2>
            
            <table>
                <tr>
                    <th colspan="3">URL_Mappings Table</th>
                </tr>
                <tr>
                    <th>Column</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>short_code</td>
                    <td>VARCHAR(7) PK</td>
                    <td>Unique short code</td>
                </tr>
                <tr>
                    <td>long_url</td>
                    <td>VARCHAR(2048)</td>
                    <td>Original URL</td>
                </tr>
                <tr>
                    <td>user_id</td>
                    <td>INT</td>
                    <td>Creator's user ID</td>
                </tr>
                <tr>
                    <td>created_at</td>
                    <td>TIMESTAMP</td>
                    <td>Creation time</td>
                </tr>
                <tr>
                    <td>expiry_date</td>
                    <td>TIMESTAMP</td>
                    <td>Expiration time</td>
                </tr>
                <tr>
                    <td>click_count</td>
                    <td>INT</td>
                    <td>Number of clicks</td>
                </tr>
            </table>
        </section>

        <!-- URL Encoding Algorithm -->
        <section class="section">
            <h2 class="section-title">URL Encoding Algorithm</h2>
            
            <div class="component-box">
                <div class="component-title">Approach 1: Hash-based (MD5/SHA256)</div>
                <p>Generate hash of long URL and take first 6-7 characters</p>
                <div class="code-snippet">
<pre>def encode_url(long_url):
    hash_value = md5(long_url).hexdigest()
    short_code = hash_value[:7]
    # Handle collisions with incrementing suffix
    return short_code</pre>
                </div>
                <div class="pros-cons">
                    <div class="pros">
                        <strong>Pros:</strong>
                        <ul>
                            <li>Simple to implement</li>
                            <li>Same URL always gets same code</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <strong>Cons:</strong>
                        <ul>
                            <li>Collision handling needed</li>
                            <li>Not sequential</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="component-box">
                <div class="component-title">Approach 2: Base62 Encoding with Counter</div>
                <p>Use auto-incrementing ID and convert to base62 (0-9, a-z, A-Z)</p>
                <div class="code-snippet">
<pre>def base62_encode(num):
    chars = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"
    base = len(chars)
    result = []
    
    while num > 0:
        result.append(chars[num % base])
        num //= base
    
    return ''.join(reversed(result))</pre>
                </div>
                <div class="pros-cons">
                    <div class="pros">
                        <strong>Pros:</strong>
                        <ul>
                            <li>No collisions</li>
                            <li>Predictable length</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <strong>Cons:</strong>
                        <ul>
                            <li>Sequential (security concern)</li>
                            <li>Needs distributed counter</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Scalability Considerations -->
        <section class="section">
            <h2 class="section-title">Scalability & Optimizations</h2>
            
            <div class="tradeoff-box">
                <strong>Caching Strategy:</strong>
                <ul>
                    <li>Cache popular URLs (80/20 rule applies)</li>
                    <li>Use Redis/Memcached for O(1) lookups</li>
                    <li>LRU eviction policy</li>
                    <li>Cache aside pattern</li>
                </ul>
            </div>

            <div class="tradeoff-box">
                <strong>Database Sharding:</strong>
                <ul>
                    <li>Shard by first character of short_code</li>
                    <li>Or use consistent hashing</li>
                    <li>Master-slave replication for read scalability</li>
                </ul>
            </div>

            <div class="tradeoff-box">
                <strong>Rate Limiting:</strong>
                <ul>
                    <li>Prevent abuse (1000 URLs/hour per user)</li>
                    <li>Token bucket or leaky bucket algorithm</li>
                    <li>IP-based or user-based limits</li>
                </ul>
            </div>

            <div class="tradeoff-box">
                <strong>Analytics:</strong>
                <ul>
                    <li>Use message queue (Kafka) for async processing</li>
                    <li>Store click events separately</li>
                    <li>Aggregate in real-time or batch process</li>
                </ul>
            </div>
        </section>

        <!-- Key Takeaways -->
        <section class="section">
            <h2 class="section-title">Key Takeaways</h2>
            <div class="tradeoff-box">
                <ul>
                    <li>Base62 encoding provides collision-free short codes</li>
                    <li>Caching is critical for read-heavy workloads (100:1 ratio)</li>
                    <li>Database sharding needed beyond certain scale</li>
                    <li>Consider tradeoffs: simplicity vs scalability vs cost</li>
                    <li>Always calculate capacity estimates first</li>
                    <li>Design for failure: handle database outages, cache misses</li>
                </ul>
            </div>
        </section>

        <footer>
            Solution documented on September 26, 2025
        </footer>
    </div>
</body>
</html>